# 트랜잭션(Transaction)

### 정의
데이터베이스의 상태를 변경시키기 위해 수행하는 작업 단위</br>

- 상태를 변경시킨다?
    - SQL을 통해 DB를 변경시킨다는 뜻
    - 일반적으로 **``CRUD``** 를 뜻함

### 예시
**A, B, C가 상금을 각각 100만원씩 받았다.**

✔ DB에서 일어나는 일

1. 대회 주최자 계좌에서 300만원 차감(UPDATE문)
2. A계좌에 100만원 추가(UPDATE문)
3. B계좌에 100만원 추가(UPDATE문)
4. C계좌에 100만원 추가(UPDATE문)

</br>

**하나의 트랜잭션** : 1 + 2 + 3 + 4번의 UPDATE문 전체
- **Commit(저장)** : 4개의 UPDATE 쿼리문이 모두 실패없이 완료되어 하나의 트랜잭션이 완료되는 것</br>
- **Rollback(철회)** : 4개의 쿼리문 중 1개라도 실패하면 모든 쿼리문을 취소하고 이전 상태로 돌려놓아야 한다.
    
    - **Rollback이 필요한 이유?**</br>
    예를 들어, 위의 4개의 쿼리문에서</br>

        대회 주최자 계좌에서 300만원 차감(–300만원) -> **완료**</br>
        A계좌에 100만원 추가(+100만원) -> **완료**</br>
        B계좌에 100만원 추가(+0만원) -> **실패**</br>

        위와 같이, 어떤 것의 문제로 인해 B부터 저장이 실패했다면 처리가 잘못된 것이므로 처음부터 다시 저장을 해야되는데</br>
        그럼 1,2번이 저장된 상태에서 또 한번더 실행이 되므로
        결과적으로

        대회주최자 계좌에서 300만원 차감추가(–600만원) -> **완료**</br>
        A계좌에 100만원 추가(+200만원) -> **완료**</br>
        B계좌에 100만원 추가(+100만원) -> **완료**</br>
        C계좌에 100만원 추가(+100만원) -> **완료**</br>

        이런 사태가 벌어질 수도 있기 때문에 `Rollback`이 필요하다.

</br></br>

### 특징
- **원자성(Atomicity)**
    - 트랜잭션이 DB에 모두 반영되거나, 혹은 전혀 반영되지 않아야 된다.
    - **All or Nothing**이라고 생각하면 된다.

- **일관성(Consistency)**
    - 트랜잭션의 작업 처리 결과는 항상 일관성 있어야 한다.
    - 제약조건, 데이터 타입, cascades 등을 포함한 정의된 모든 조건에 맞게 데이터의 값이 변경됨을 의미한다.
    - 즉, **사전에 정의한 조건과 맞지 않는 데이터의 변경으로 인해 오류가 발생하지 않음을 보장**해준다.

- **독립성(Isolation)**
    - 독립성은 하나의 트랜잭션은 다른 트랜잭션에 끼어들 수 없고 마찬가지로 독립적임을 의미한다.
    - **수행중인 트랜잭션이 완료될 때까지 다른 트랜잭션의 요청을 막음**으로써 업데이트가 누락되는 등, 데이터가 꼬이는 것을 방지해줄 수 있다.

- **지속성(Durability)**
    - 트랜잭션이 성공적으로 완료되면 영구적으로 결과에 반영되어야 한다.
    - 즉, **커밋된 연산이 영구적으로 지속**됨을 보장한다.


