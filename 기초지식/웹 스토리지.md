# WebStorage(Local, Session)

### 웹 스토리지 생성 배경

> - HTTP는 요청과 응답으로 이뤄지는 하나의 사이클이 끝나면, 연결이 끊어지는 무상태성을 띄고 클라이언트의 상태를 보존하지 않는다.
> - 클라이언트의 상태를 서버가 아닌 클라이언트에 저장해두고 필요시마다 데이터를 꺼내서 서버에 전달하는 방식으로 HTTP의 단점을 보완하고자 쿠키와 웹 스토리지를 사용하게 되었다.

<img src = "https://user-images.githubusercontent.com/84119178/233231813-cf33dad7-2864-4be1-a428-16997d0dfca4.jpeg" width = "700">

</br>

[쿠키](https://github.com/crupy/TIL/blob/master/Network/HTTP/HTTP%20%ED%97%A4%EB%8D%94%20%EA%B8%B0%EB%B3%B8.md#%EC%BF%A0%ED%82%A4)에 대한 자세한 설명은 여기를 참조하면 될 것 같다.

</br>

## 웹 스토리지

> - **로컬 스토리지**와 **세션 스토리지**가 존재
> - 클라이언트에 데이터를 저장할 수 있도록 HTML5부터 나온 새로운 방식의 데이터 저장소
> - key와 value 쌍의 형태로 데이터 저장
> - window 객체의 프로퍼티로 존재
>   - 프로퍼티 : 자바스크립트에서 객체의 속성을 나타낸다.</br>
객체 : key, value로 구성된 속성들의 집합

</br>

## 로컬 스토리지 vs. 세션 스토리지

두 개의 매커니즘의 차이점은 데이터가 어떤 범위 내에서 얼마나 오래 보존되느냐에 있다. </br>

> **세션 스토리지** : 웹페이지의 세션이 끝날 때 저장된 데이터가 지워진다. </br>
> `ex) 브라우저에서 같은 웹사이트를 여러 탭이나 창에 띄우면, 여러 개의 세션 스토리지에 데이터가 서로 격리되어 저장.` </br>
> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`각 탭이나 창이 닫힐 때 저장해 둔 데이터도 함께 소멸.`

> **로컬 스토리지** : 웹페이지의 세션이 끝나더라도 데이터가 지워지지 않는다.</br>
> `ex) 여러 탭이나 창 간에 데이터가 서로 공유되며 탭이나 창을 닫아도 데이터는 브라우저에 그대로 남아 있음.`

</br>

**하지만** </br>
로컬 스토리지의 데이터 영속성(persistence) 어디까지나 계속해서 동일한 컴퓨터에서 동일한 브라우저를 사용할 때만 해당된다.</br>

즉, 같은 컴퓨터에서 다른 브라우저를 사용하거나 `(e.g. 크롬을 쓰다가 사파리를 쓰면)`, 또는 다른 컴퓨터에서 같은 브라우저를 사용하는 경우에는 `(e.g. 집에서 크롬을 쓰다가 회사에서 크롬을 쓰면)`, 엄연히 다른 브라우저이므로 서로 다른 두 개의 로컬 스토리지에 데이터가 저장된다.

로컬 스토리지와 세션 스토리지의 공통점은 두 기술 모두 **데이터를 브라우저 상에 저장**한다는 것이며, 자바스크립트 API가 완전히 동일한 형태이다.

</br>

## 기본 API

웹 스토리지는 기본적으로 키(key)와 값(value)으로 이루어진 데이터를 저장할 수 있다. </br>

> 자바스크립트 API의 기본적인 사용 방법(localStorage = sessionStorage)

```javascript
// 키에 데이터 쓰기
localStorage.setItem("key", value);

// 키로 부터 데이터 읽기
localStorage.getItem("key");

// 키의 데이터 삭제
localStorage.removeItem("key");

// 모든 키의 데이터 삭제
localStorage.clear();

// 저장된 키/값 쌍의 개수
localStorage.length;
```

## 주의점

웹 스토리지는 오직 문자형(string) 데이터 타입만 지원한다.

예를 들어, 숫자형 데이터를 로컬 스토리지에 쓰고 다시 다시 읽어보면 다음과 같이 본래 숫자가 아닌 문자가 나오는 것을 알 수 있다.

```javascript
> localStorage.setItem('num', 1)
undefined
> localStorage.getItem('num') === 1
false
> localStorage.getItem('num')
"1"
> typeof localStorage.getItem('num')
"string"
> localStorage.setItem('obj', {a: 1, b: 2})
undefined
> localStorage.getItem('obj')
"[object Object]"
```

이러한 문제가 발생하는 이유는 웹 스토리지는 문자열 데이터 밖에 저장할 수 없기 때문에, 다른 타입의 데이터를 저장하려고 할 때 문자형으로 변환을 하기 때문이다.

--> 이 문제를 해결하는 방법이 **JSON**을 활용하는 것이다!

</br>

### 해결 방법

웹 스토리지를 사용할 때 위와 같은 문제를 피하기 위해서 많이 사용하는 방법이 JSON 형태로 데이터를 읽고 쓰는 것.

```javascript
> localStorage.setItem('json', JSON.stringify({a: 1, b: 2}))
undefined
> JSON.parse(localStorage.getItem('json'))
{a: 1, b: 2}
```

위와 같이 로컬 스토리지에 쓸 데이터를 JSON 형태로 직렬화(serialization)하고, 읽은 데이터를 JSON 형태로 역직렬화(deserialization)해주면 원본의 데이터를 그대로 얻을 수 있다.

배열형 데이터를 로컬 스토리지에 저장할 때도 동일한 방법의 문제를 예방할 수 있다.

```javascript
> localStorage.setItem('nums', JSON.stringify([1, 2, 3]))
undefined
> JSON.parse(localStorage.getItem('nums'))
[1, 2, 3]
```

</br>

## 로컬 스토리지를 사용하는 이유
1. **데이터 유지**</br>
로컬 스토리지에 저장된 데이터는 사용자가 로그아웃하거나 브라우저를 종료해도 유지된다.</br>
따라서 사용자가 웹사이트를 다시 방문할 때마다 설정 정보를 다시 선택하지 않아도 된다.

2. **클라이언트 측에서 처리**</br>
웹 사이트에서 쿠키를 설정하면 이후 모든 웹 요청은 쿠키정보를 포함하여 서버로 전송된다.</br> 
하지만 로컬 스토리지는 저장된 데이터가 클라이언트에 존배할 뿐 서버로 전송은 되지 않아 서버에 부담을 덜 준다. </br>
또한 클라이언트 측에서 처리되기 때문에 빠르고 응답성도 좋다.

3. **용량**</br> 
보통 하나의 사이트에서 저장할 수 있는 쿠키의 수는 최대 20개이고 최대쿠키 크기는 최대 4KB로 제한되어 있다.</br>
반면에, 로컬 스토리지는 대개 5MB ~ 10MB 정도의 용량을 가지고 있지만 이론상으로는 제한이 없다.

4. **영구 데이터 저장이 가능**</br>
쿠키는 만료일자를 지정하게 되어 있어 언젠가는 제거된다. (예외 : 세션쿠키)</br>
WebStorage는 만료기간의 설정이 없어서 한번 저장한 데이터는 영구적으로 존재한다.

5. **보안**</br> 
로컬 스토리지는 HTTPS 연결을 통해 암호화되기 때문에 다른 사용자나 악의적인 사용자가 접근할 수 없다.

</br>

### 로컬 스토리지 사용처
웹 로컬 스토리지는 주로 웹 애플리케이션에서 사용자가 선택한 설정이나 상태 정보를 저장하는데 사용됨.

ex) 사용자가 특정 웹사이트에서 선택한 언어, 테마, 폰트 크기등의 설정 정보를 웹 로컬 스토리지에 저장할 수 있고</br>
이렇게 저장된 정보는 웹사이트를 다시 방문할 때마다 불러와서 이전과 같은 사용자 설정을 적용할 수 있다.

<img src="https://user-images.githubusercontent.com/84119178/233514129-e8ec0e5c-e060-44e0-b4d9-9fced26598ee.png">
